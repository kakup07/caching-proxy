#!/bin/bash
# Default values
PORT=3000
ORIGIN="https://dummyjson.com"
CLEAR_CACHE=false

# Read command line arguments
while [[ $# -gt 0 ]]; do
  case $1 in
    --port)
      PORT="$2"
      shift 2
      ;;
    --origin)
      ORIGIN="$2"
      shift 2
      ;;
    --clear-cache)
      CLEAR_CACHE=true
      shift
      ;;
    *)
      echo "Unknown parameter: $1"
      exit 1
      ;;
  esac
done

CACHE_FILE="./data/cached-requests.json"

if [ "$CLEAR_CACHE" = true ]; then
  if [ -f "$CACHE_FILE" ]; then
    rm "$CACHE_FILE"
    echo "Cache cleared: $CACHE_FILE deleted."
  else
    echo "No cache file found to clear."
  fi
  exit 0
fi

echo "Starting caching proxy on port $PORT with origin $ORIGIN"
PORT=$PORT ORIGIN=$ORIGIN node server.js